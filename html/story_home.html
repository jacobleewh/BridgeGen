{% extends "base.html" %}
{% block content %}

<!-- Banner -->
<div class="banner">
  <h2>Stories – Find out more about others' stories</h2>
</div>

<!-- My Stories Section -->
<div class="big-card mb-4">
  <div class="big-card-header header-soft-blue">
    <h5><i class="bi bi-bookmark-fill"></i> My Stories</h5>
    <p class="mb-0 text-muted small">Stories you've created and published</p>
  </div>
  <div class="big-card-body">
    {% if my_stories %}
      <div class="row">
        {% for s in my_stories %}
          <div class="col-md-6 mb-3">
            <!-- My Story Card -->
            <div class="story-card my-story">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0">{{ s.title }}</h6>
                <span class="badge bg-primary">Your Story</span>
              </div>
                {% if s.media and s.media|length > 0 %}
                <img src="{{ url_for('static', filename=s.media[0].replace('static/', '')) }}" alt="Story media" class="img-fluid rounded mb-2">
              {% endif %}
              <p>{{ s.description }}</p>
              <div class="tags"><strong>Tags:</strong> {{ ", ".join(s.tags) }}</div>
              <div class="meta"><strong>Stats:</strong> Likes: {{ s.likes }} • Comments: {{ s.comments|length }} • Published: {{ s.date }}</div>

              {% if s.voice %}
                <audio controls class="mt-2 w-100">
                  <source src="{{ s.voice }}" type="audio/webm">
                </audio>
              {% endif %}

              <div class="d-flex justify-content-end gap-2 mt-2">
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('story_my_story', story_id=s.id) }}">View</a>
                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('story_edit', story_id=s.id) }}">Edit</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="dashboard-link text-center mt-3">
        <a class="btn btn-dashboard" href="{{ url_for('story_my_stories') }}">
          <i class="bi bi-journal-text"></i> View All My Stories Dashboard
        </a>
      </div>
    {% else %}
      <p class="text-muted"><i class="bi bi-info-circle"></i> No stories yet. Create your first story above to get started!</p>
    {% endif %}
  </div>
</div>

<!-- Recommended Section -->
<div class="big-card mb-4">
  <div class="big-card-header header-soft-green">
    <h5><i class="bi bi-star-fill"></i> Recommended for You</h5>
    <p class="mb-0 text-muted small">Stories from others that match your interests</p>
  </div>
  <div class="big-card-body">
    {% if recommended %}
      <div class="row">
        {% for s in recommended %}
          <div class="col-md-6 mb-3">
            <!-- Other User's Story Card -->
            <div class="story-card other-story">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h6 class="mb-0">{{ s.title }}</h6>
                  <small class="text-muted">by {{ s.author }}</small>
                </div>
                <span class="badge bg-success">Others' Story</span>
              </div>
              {% if s.media and s.media|length > 0 %}
                <img src="{{ url_for('static', filename=s.media[0].replace('static/', '')) }}" alt="Story media" class="img-fluid rounded mb-2">
              {% endif %}
              <p>{{ s.description }}</p>
              <div class="tags"><strong>Tags:</strong> {{ ", ".join(s.tags) }}</div>
              <div class="meta"><strong>By:</strong> {{ s.author }} • <strong>Stats:</strong> Likes: {{ s.likes }} • Comments: {{ s.comments|length }} • {{ s.date }}</div>

              {% if s.voice %}
                <audio controls class="mt-2 w-100">
                  <source src="{{ s.voice }}" type="audio/webm">
                </audio>
              {% endif %}

              <div class="d-flex justify-content-end gap-2 mt-2">
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('story_details', story_id=s.id) }}">View</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="dashboard-link text-center mt-3">
        <a class="btn btn-dashboard" href="{{ url_for('story_browse') }}">
          <i class="bi bi-compass"></i> Explore More Stories
        </a>
      </div>
    {% else %}
      <p class="text-muted"><i class="bi bi-info-circle"></i> No recommendations yet. Create your stories to help us find more stories you might like!</p>
    {% endif %}
  </div>
</div>

<link rel="stylesheet" href="{{ url_for('static', filename='story_style.css') }}">
<script src="{{ url_for('static', filename='js/story_script.js') }}"></script>
{% endblock %}
